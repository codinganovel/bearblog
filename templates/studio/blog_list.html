{% extends 'base.html' %}

{% block title %}Blog list | Bear Blog{% endblock %}

{% block custom_styles %}
    {% include 'styles/blog/default.css' %}
    {% include 'styles/dashboard.css' %}
    {% include 'snippets/styles.html' with blog=blogs.0 %}
{% endblock %}

{% block nav %}{% endblock %}

{% block content %}

<h1>Your blogs</h1>

{# Single-blog personal CMS: upgrade restrictions removed #}

<ul style="list-style:none; padding:0; margin:0;">
{% for blog in blogs %}
    <li style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; padding:8px 0; border-bottom:1px solid #eee;">
        <a href="{% url 'dashboard' %}" style="flex:1; min-width:150px;">{{ blog.title }}</a>
        <small style="white-space:nowrap;">
            <a href="{% url 'posts_edit' %}">Posts</a>
            | <a href="{% url 'pages_edit' %}">Pages</a>
            | <a href="{% url 'analytics' %}">Analytics</a>
            | <a href="{% url 'settings' %}">Settings</a>
        </small>
    </li>
{% endfor %}
</ul>
{# Single-blog flow: show create form by default #}
{% if error_messages %}
<p style="color:lightsalmon">
    {% for error_message in error_messages %}
        {{ error_message }}<br>
    {% endfor %}
</p>
{% endif %}
{% if blogs|length < 1 %}
<h3>Create a new blog</h3>
<form method="POST" class="post-form full-width">
    {% csrf_token %}
    {{ form.as_p }}
    <p>
        <button type="submit">Create</button>
    </p>
</form>
{% endif %}
{% if error_messages %}
<p style="color:lightsalmon">
    {% for error_message in error_messages %}
        {{ error_message }}<br>
    {% endfor %}
</p>
{% endif %}
{# End single-blog adjustments #}

{% endif %}


<h2>Account</h2>

<p>
    <a href="{% url 'account_logout' %}">Sign out</a>
</p>

<p>
    <a href="{% url 'dashboard_customisation' %}">Customise dashboard</a>
</p>

<p>
    <a href="/accounts/email/">Update email address</a>
</p>
<p>
    <a href="/accounts/password/change/">Change password</a>
</p>

{% if subscription_link %}
<p>
    You're currently on a <b>{{ variant }}</b> subscription.
    <br>
    Upgrade to
    {% if variant == "Monthly" and upgrade_subscription_link %}
    <a href="{{ upgrade_subscription_link }}" target="_blank">Yearly</a>
    (2 months free) or {% endif %}
    <a href="https://docs.bearblog.dev/upgrading-from-subscription-to-lifetime/" target="_blank">Lifetime</a>
    (once-off purchase).  
</p>
<p>
    <a href="{{ subscription_link }}" target="_blank">Manage subscription</a>
</p>
{% endif %}

<p>
    {% if subscription_link and not subscription_cancelled %}
    <a onclick="alert('Please cancel your subscription before deleting your account.')">Delete account</a>
    {% else %}
    <a href="{% url 'user_delete' %}">Delete account</a>
    {% endif %}
</p>

{% endblock %}